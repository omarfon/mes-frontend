<div class="space-y-5">
  <!-- Header -->
  <div class="ui-page-header">
    <div>
      <h3 class="ui-title">Dashboard de Calidad</h3>
      <p class="ui-subtitle">Resumen de inspecciones y defectos del día</p>
    </div>

    <div class="flex items-center gap-3">
      <label class="text-sm text-slate-300">Fecha:</label>
      <input 
        type="date" 
        [(ngModel)]="selectedDate" 
        (change)="onDateChange()"
        class="ui-input w-48"
      />
    </div>
  </div>

  <!-- KPIs principales -->
  <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-4">
    <!-- Total Inspecciones -->
    <div class="ui-surface p-5">
      <div class="flex items-center justify-between mb-3">
        <div class="h-12 w-12 rounded-xl bg-blue-500/10 border border-blue-500/20 flex items-center justify-center">
          <span class="pi pi-check-circle text-blue-400 text-xl"></span>
        </div>
        <span class="text-xs text-slate-400">Total</span>
      </div>
      <p class="text-3xl font-bold text-slate-100">{{ dailyStats.totalInspections }}</p>
      <p class="text-xs text-slate-400 mt-1">Inspecciones</p>
    </div>

    <!-- Tasa de Aprobación -->
    <div class="ui-surface p-5">
      <div class="flex items-center justify-between mb-3">
        <div class="h-12 w-12 rounded-xl bg-green-500/10 border border-green-500/20 flex items-center justify-center">
          <span class="pi pi-thumbs-up text-green-400 text-xl"></span>
        </div>
        <span class="text-xs text-slate-400">Pass Rate</span>
      </div>
      <p class="text-3xl font-bold text-green-400">{{ dailyStats.passRate.toFixed(1) }}%</p>
      <p class="text-xs text-slate-400 mt-1">{{ dailyStats.passed }} Aprobadas / {{ dailyStats.failed }} Rechazadas</p>
    </div>

    <!-- Total Defectos -->
    <div class="ui-surface p-5">
      <div class="flex items-center justify-between mb-3">
        <div class="h-12 w-12 rounded-xl bg-orange-500/10 border border-orange-500/20 flex items-center justify-center">
          <span class="pi pi-exclamation-triangle text-orange-400 text-xl"></span>
        </div>
        <span class="text-xs text-slate-400">Defectos</span>
      </div>
      <p class="text-3xl font-bold text-orange-400">{{ dailyStats.totalDefects }}</p>
      <p class="text-xs text-slate-400 mt-1">Total encontrados</p>
    </div>

    <!-- Defectos Críticos -->
    <div class="ui-surface p-5">
      <div class="flex items-center justify-between mb-3">
        <div class="h-12 w-12 rounded-xl bg-red-500/10 border border-red-500/20 flex items-center justify-center">
          <span class="pi pi-times-circle text-red-400 text-xl"></span>
        </div>
        <span class="text-xs text-slate-400">Críticos</span>
      </div>
      <p class="text-3xl font-bold text-red-400">{{ dailyStats.criticalDefects }}</p>
      <p class="text-xs text-slate-400 mt-1">Severidad alta</p>
    </div>
  </div>

  <!-- Gráficos y análisis -->
  <div class="grid grid-cols-1 xl:grid-cols-2 gap-4">
    <!-- Defectos por Familia -->
    <div class="ui-surface p-5">
      <div class="flex items-center justify-between mb-4">
        <p class="text-sm font-semibold">Defectos por Familia</p>
        <span class="text-xs text-slate-400">Top categorías</span>
      </div>

      <div class="space-y-4" *ngIf="defectsByFamily.length > 0">
        <div *ngFor="let item of defectsByFamily" class="space-y-2">
          <div class="flex items-center justify-between text-xs">
            <span class="text-slate-300">{{ item.family }}</span>
            <span class="text-slate-400">{{ item.count }} ({{ item.percentage.toFixed(1) }}%)</span>
          </div>
          <div class="h-2 bg-slate-800/50 rounded-full overflow-hidden">
            <div 
              class="h-full bg-gradient-to-r from-blue-500 to-purple-500 rounded-full transition-all duration-500"
              [style.width.%]="item.percentage"
            ></div>
          </div>
        </div>
      </div>

      <div *ngIf="defectsByFamily.length === 0" class="text-center py-8 text-slate-500 text-sm">
        Sin defectos registrados
      </div>
    </div>

    <!-- Inspecciones por Tipo -->
    <div class="ui-surface p-5">
      <div class="flex items-center justify-between mb-4">
        <p class="text-sm font-semibold">Inspecciones por Tipo</p>
        <span class="text-xs text-slate-400">Distribución</span>
      </div>

      <div class="space-y-4" *ngIf="inspectionsByType.length > 0">
        <div *ngFor="let item of inspectionsByType" class="rounded-xl border border-slate-800/70 bg-slate-900/20 p-4">
          <div class="flex items-center justify-between mb-3">
            <span class="text-sm font-semibold text-slate-200">{{ item.type }}</span>
            <span class="ui-badge">{{ item.count }} total</span>
          </div>

          <div class="grid grid-cols-2 gap-3">
            <div class="text-center">
              <p class="text-2xl font-bold text-green-400">{{ item.passed }}</p>
              <p class="text-xs text-slate-400 mt-1">Aprobadas</p>
            </div>
            <div class="text-center">
              <p class="text-2xl font-bold text-red-400">{{ item.failed }}</p>
              <p class="text-xs text-slate-400 mt-1">Rechazadas</p>
            </div>
          </div>
        </div>
      </div>

      <div *ngIf="inspectionsByType.length === 0" class="text-center py-8 text-slate-500 text-sm">
        Sin inspecciones registradas
      </div>
    </div>
  </div>

  <!-- Top 5 Defectos y Tendencias -->
  <div class="grid grid-cols-1 xl:grid-cols-3 gap-4">
    <!-- Top 5 Defectos -->
    <div class="ui-surface p-5">
      <div class="flex items-center justify-between mb-4">
        <p class="text-sm font-semibold">Top 5 Defectos</p>
        <span class="pi pi-chart-bar text-slate-400"></span>
      </div>

      <div class="space-y-3" *ngIf="topDefects.length > 0">
        <div *ngFor="let defect of topDefects; let i = index" class="flex items-center gap-3">
          <div class="h-8 w-8 rounded-lg bg-slate-800/60 flex items-center justify-center text-xs font-bold">
            {{ i + 1 }}
          </div>
          <div class="flex-1 min-w-0">
            <p class="text-sm text-slate-200 truncate">{{ defect.name }}</p>
            <div class="h-1.5 bg-slate-800/50 rounded-full mt-1 overflow-hidden">
              <div 
                class="h-full bg-gradient-to-r from-orange-500 to-red-500 rounded-full"
                [style.width.%]="getBarWidth(defect.count, topDefects[0]?.count || 1)"
              ></div>
            </div>
          </div>
          <span class="text-sm font-bold text-orange-400">{{ defect.count }}</span>
        </div>
      </div>

      <div *ngIf="topDefects.length === 0" class="text-center py-8 text-slate-500 text-sm">
        Sin defectos registrados
      </div>
    </div>

    <!-- Inspecciones Recientes -->
    <div class="ui-surface p-5 xl:col-span-2">
      <div class="flex items-center justify-between mb-4">
        <p class="text-sm font-semibold">Inspecciones Recientes</p>
        <span class="text-xs text-slate-400">Últimas 10</span>
      </div>

      <div class="overflow-x-auto">
        <table class="ui-table">
          <thead class="ui-thead">
            <tr>
              <th class="ui-th">Código</th>
              <th class="ui-th">Tipo</th>
              <th class="ui-th">Lote</th>
              <th class="ui-th">Resultado</th>
              <th class="ui-th">Defectos</th>
            </tr>
          </thead>
          <tbody class="bg-slate-950/20">
            <tr *ngFor="let inspection of recentInspections" class="ui-tr">
              <td class="ui-td">{{ inspection.code }}</td>
              <td class="ui-td">
                <span class="ui-badge">{{ inspection.type }}</span>
              </td>
              <td class="ui-td text-xs">{{ inspection.lotCode || '-' }}</td>
              <td class="ui-td">
                <span 
                  class="ui-badge"
                  [class.ui-badge-ok]="inspection.result === 'PASS'"
                  [class.ui-badge-warn]="inspection.result === 'HOLD'"
                  [class.ui-badge-bad]="inspection.result === 'FAIL'"
                >
                  {{ inspection.result }}
                </span>
              </td>
              <td class="ui-td">
                <span class="text-orange-400 font-semibold">
                  {{ getTotalFindings(inspection) }}
                </span>
              </td>
            </tr>

            <tr *ngIf="recentInspections.length === 0">
              <td colspan="5" class="px-4 py-8 text-center text-slate-500">
                Sin inspecciones para hoy
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Distribución Pass/Fail/Hold -->
  <div class="ui-surface p-5">
    <div class="flex items-center justify-between mb-4">
      <p class="text-sm font-semibold">Distribución de Resultados</p>
      <span class="text-xs text-slate-400">{{ dailyStats.totalInspections }} inspecciones</span>
    </div>

    <div class="grid grid-cols-3 gap-4">
      <div class="text-center">
        <div class="relative inline-block">
          <svg class="w-32 h-32 transform -rotate-90">
            <circle
              cx="64"
              cy="64"
              r="56"
              fill="none"
              stroke="rgb(15 23 42)"
              stroke-width="12"
            />
            <circle
              cx="64"
              cy="64"
              r="56"
              fill="none"
              stroke="rgb(34 197 94)"
              stroke-width="12"
              [attr.stroke-dasharray]="2 * 3.14159 * 56"
              [attr.stroke-dashoffset]="2 * 3.14159 * 56 * (1 - dailyStats.passed / (dailyStats.totalInspections || 1))"
              class="transition-all duration-500"
            />
          </svg>
          <div class="absolute inset-0 flex items-center justify-center">
            <span class="text-2xl font-bold text-green-400">{{ dailyStats.passed }}</span>
          </div>
        </div>
        <p class="text-sm text-slate-300 mt-2">Aprobadas</p>
        <p class="text-xs text-slate-500">{{ dailyStats.totalInspections > 0 ? (dailyStats.passed / dailyStats.totalInspections * 100).toFixed(1) : 0 }}%</p>
      </div>

      <div class="text-center">
        <div class="relative inline-block">
          <svg class="w-32 h-32 transform -rotate-90">
            <circle
              cx="64"
              cy="64"
              r="56"
              fill="none"
              stroke="rgb(15 23 42)"
              stroke-width="12"
            />
            <circle
              cx="64"
              cy="64"
              r="56"
              fill="none"
              stroke="rgb(239 68 68)"
              stroke-width="12"
              [attr.stroke-dasharray]="2 * 3.14159 * 56"
              [attr.stroke-dashoffset]="2 * 3.14159 * 56 * (1 - dailyStats.failed / (dailyStats.totalInspections || 1))"
              class="transition-all duration-500"
            />
          </svg>
          <div class="absolute inset-0 flex items-center justify-center">
            <span class="text-2xl font-bold text-red-400">{{ dailyStats.failed }}</span>
          </div>
        </div>
        <p class="text-sm text-slate-300 mt-2">Rechazadas</p>
        <p class="text-xs text-slate-500">{{ dailyStats.totalInspections > 0 ? (dailyStats.failed / dailyStats.totalInspections * 100).toFixed(1) : 0 }}%</p>
      </div>

      <div class="text-center">
        <div class="relative inline-block">
          <svg class="w-32 h-32 transform -rotate-90">
            <circle
              cx="64"
              cy="64"
              r="56"
              fill="none"
              stroke="rgb(15 23 42)"
              stroke-width="12"
            />
            <circle
              cx="64"
              cy="64"
              r="56"
              fill="none"
              stroke="rgb(251 191 36)"
              stroke-width="12"
              [attr.stroke-dasharray]="2 * 3.14159 * 56"
              [attr.stroke-dashoffset]="2 * 3.14159 * 56 * (1 - dailyStats.hold / (dailyStats.totalInspections || 1))"
              class="transition-all duration-500"
            />
          </svg>
          <div class="absolute inset-0 flex items-center justify-center">
            <span class="text-2xl font-bold text-yellow-400">{{ dailyStats.hold }}</span>
          </div>
        </div>
        <p class="text-sm text-slate-300 mt-2">En espera</p>
        <p class="text-xs text-slate-500">{{ dailyStats.totalInspections > 0 ? (dailyStats.hold / dailyStats.totalInspections * 100).toFixed(1) : 0 }}%</p>
      </div>
    </div>
  </div>
</div>
